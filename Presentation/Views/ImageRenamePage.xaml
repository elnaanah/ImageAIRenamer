<Page x:Class="ImageAIRenamer.Presentation.Views.ImageRenamePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:domain="clr-namespace:ImageAIRenamer.Domain.Entities"
      mc:Ignorable="d"
      Title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„ØµÙˆØ±"
      FlowDirection="RightToLeft"
      Background="{StaticResource BackgroundColor}">
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0">
        <Grid x:Name="MainGrid" Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="20"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header Button -->
            <Button Content="ðŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" 
                    Command="{Binding BackToHomeCommand}"
                    Style="{StaticResource SecondaryButtonStyle}"
                    HorizontalAlignment="Right"
                    MinWidth="150"
                    Grid.Row="0"/>

            <!-- Main Content -->
            <Grid x:Name="ContentGrid" Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" MinWidth="350" MaxWidth="500"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="3*" MinWidth="400"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - Settings -->
                <ScrollViewer x:Name="LeftPanel" Grid.Column="0" 
                              VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel>
                        <!-- API Keys Section -->
                        <GroupBox Header="ðŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API" Style="{StaticResource ModernGroupBoxStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Ø£Ø¯Ø®Ù„ Ù…ÙØ§ØªÙŠØ­ Gemini API (Ù…ÙØªØ§Ø­ ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±):" 
                                           Margin="0,0,0,8" 
                                           Foreground="{StaticResource TextPrimaryColor}" 
                                           FontWeight="Medium"/>
                                <TextBox Height="80" 
                                         AcceptsReturn="True" 
                                         VerticalScrollBarVisibility="Auto" 
                                         TextWrapping="NoWrap" 
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         Text="{Binding ApiKeys, UpdateSourceTrigger=PropertyChanged}"
                                         ToolTip="Ø£Ø¯Ø®Ù„ Ù…ÙØ§ØªÙŠØ­ Gemini API Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒØŒ Ù…ÙØªØ§Ø­ ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±"/>
                                <CheckBox Content="âš¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ³Ø±ÙŠØ¹ (Ø§Ø³ØªØ®Ø¯Ø§Ù… API keys Ù…ØªÙˆØ§Ø²ÙŠ)" 
                                          IsChecked="{Binding EnableSpeedBoost, UpdateSourceTrigger=PropertyChanged}"
                                          Margin="0,12,0,0"
                                          Foreground="{StaticResource TextPrimaryColor}"
                                          FontWeight="Medium"
                                          ToolTip="Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø³ÙŠØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø¹Ù„Ù‰ API keys Ù…Ø®ØªÙ„ÙØ© Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²ÙŠ Ù…Ù…Ø§ ÙŠØ³Ø±Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©. ÙŠØªØ·Ù„Ø¨ Ù…ÙØªØ§Ø­ÙŠÙ† API Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Folder Selection Section -->
                        <GroupBox Header="ðŸ“ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª" Style="{StaticResource ModernGroupBoxStyle}" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="12"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Ù…Ø¬Ù„Ø¯ Ø§Ù„ØµÙˆØ±:" 
                                           VerticalAlignment="Center" 
                                           Grid.Row="0" Grid.Column="0" 
                                           Foreground="{StaticResource TextPrimaryColor}" 
                                           FontWeight="Medium"
                                           Margin="0,0,10,0"/>
                                <TextBox Grid.Row="0" Grid.Column="1" 
                                         Margin="0,0,10,0" 
                                         Style="{StaticResource ModernTextBoxStyle}" 
                                         IsReadOnly="True" 
                                         Text="{Binding SourceFolder}"/>
                                <Button Content="ØªØµÙØ­..." 
                                        Command="{Binding BrowseSourceCommand}" 
                                        Grid.Row="0" Grid.Column="2" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        MinWidth="80"/>

                                <TextBlock Text="Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬:" 
                                           VerticalAlignment="Center" 
                                           Grid.Row="2" Grid.Column="0" 
                                           Foreground="{StaticResource TextPrimaryColor}" 
                                           FontWeight="Medium"
                                           Margin="0,0,10,0"/>
                                <TextBox Grid.Row="2" Grid.Column="1" 
                                         Margin="0,0,10,0" 
                                         Style="{StaticResource ModernTextBoxStyle}" 
                                         IsReadOnly="True" 
                                         Text="{Binding OutputFolder}"/>
                                <Button Content="ØªØµÙØ­..." 
                                        Command="{Binding BrowseOutputCommand}" 
                                        Grid.Row="2" Grid.Column="2" 
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        MinWidth="80"/>
                            </Grid>
                        </GroupBox>

                        <!-- Custom Instructions Section -->
                        <GroupBox Header="ðŸ¤– ØªØ¹Ù„ÙŠÙ…Ø§Øª AI Ù…Ø®ØµØµØ©" Style="{StaticResource ModernGroupBoxStyle}" Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù€ AI (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):" 
                                           Margin="0,0,0,8" 
                                           Foreground="{StaticResource TextPrimaryColor}" 
                                           FontWeight="Medium"/>
                                <TextBox Height="80" 
                                         AcceptsReturn="True" 
                                         VerticalScrollBarVisibility="Auto" 
                                         TextWrapping="Wrap" 
                                         Style="{StaticResource ModernTextBoxStyle}"
                                         Text="{Binding CustomInstructions, UpdateSourceTrigger=PropertyChanged}"
                                         ToolTip="Ù…Ø«Ø§Ù„: 'Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø§Ø³Ù… Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙˆØ±Ø©' Ø£Ùˆ 'Ø£Ø¹Ø¯ Ø§Ù„ØªØ³Ù…ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©'"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Actions Section -->
                        <Border Background="{StaticResource SurfaceColor}" 
                                BorderBrush="{StaticResource BorderColor}" 
                                BorderThickness="1"
                                CornerRadius="6" 
                                Padding="16">
                            <StackPanel>
                                <TextBlock Text="Ø§Ù„Ø­Ø§Ù„Ø©" 
                                           Foreground="{StaticResource TextSecondaryColor}" 
                                           FontSize="12" 
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,6"/>
                                <TextBlock Margin="0,0,0,10" 
                                           Foreground="{StaticResource TextPrimaryColor}" 
                                           FontSize="13"
                                           Text="{Binding StatusText}"/>
                                <ProgressBar Height="6"
                                             Background="{StaticResource BorderColor}" 
                                             Foreground="{StaticResource PrimaryColor}"
                                             Maximum="{Binding ProgressMaximum}" 
                                             Value="{Binding ProgressValue}"
                                             Margin="0,0,0,16">
                                    <ProgressBar.Style>
                                        <Style TargetType="ProgressBar">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsProgressVisible}" Value="True">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ProgressBar.Style>
                                </ProgressBar>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Button Content="ðŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„" 
                                            Command="{Binding ClearListCommand}" 
                                            Style="{StaticResource SecondaryButtonStyle}" 
                                            Grid.Column="0"/>
                                    <Button Content="ðŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©" 
                                            Command="{Binding ProcessCommand}" 
                                            Style="{StaticResource ModernButtonStyle}" 
                                            Grid.Column="2"/>
                                    <Button Content="âŒ Ø¥Ù„ØºØ§Ø¡" 
                                            Command="{Binding CancelCommand}" 
                                            Grid.Column="4">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsProgressVisible}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Right Panel - Image List -->
                <GroupBox x:Name="ImageListGroup" 
                          Header="ðŸ–¼ï¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ±" 
                          Grid.Column="2" 
                          Style="{StaticResource ModernGroupBoxStyle}">
                    <DataGrid AutoGenerateColumns="False" 
                              IsReadOnly="True" 
                              CanUserAddRows="False" 
                              CanUserResizeColumns="True"
                              BorderThickness="1" 
                              BorderBrush="{StaticResource BorderColor}"
                              Background="White" 
                              GridLinesVisibility="Horizontal" 
                              HorizontalGridLinesBrush="{StaticResource BorderColor}"
                              VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Auto"
                              HeadersVisibility="Column" 
                              SelectionMode="Single"
                              ItemsSource="{Binding Images}"
                              RowHeight="90">
                        <DataGrid.Resources>
                            <Style TargetType="DataGridCell">
                                <Setter Property="Padding" Value="10,6"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimaryColor}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#F8F9FA"/>
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryColor}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="HorizontalContentAlignment" Value="Right"/>
                                <Setter Property="Padding" Value="10,12"/>
                                <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Header="Ù…Ø¹Ø§ÙŠÙ†Ø©" Width="110" MinWidth="90" CanUserResize="True">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate DataType="domain:ImageItem">
                                        <Border Width="90" Height="70" 
                                                BorderBrush="{StaticResource BorderColor}" 
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Margin="5">
                                            <Image Source="{Binding FilePath}" 
                                                   Stretch="Uniform" 
                                                   Cursor="Hand" 
                                                   ToolTip="Ø§Ù†Ù‚Ø± Ù„Ù„ÙØªØ­">
                                                <Image.InputBindings>
                                                    <MouseBinding Gesture="LeftClick" 
                                                                  Command="{Binding DataContext.OpenImageCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}" 
                                                                  CommandParameter="{Binding}"/>
                                                </Image.InputBindings>
                                            </Image>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ" Binding="{Binding OriginalName}" Width="1.2*" MinWidth="140" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="TextAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="5"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" Binding="{Binding NewName}" Width="1.2*" MinWidth="140" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="TextAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="5"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Ø§Ù„Ø­Ø§Ù„Ø©" Binding="{Binding Status}" Width="0.8*" MinWidth="120" CanUserResize="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontWeight" Value="Medium"/>
                                        <Setter Property="TextAlignment" Value="Right"/>
                                        <Setter Property="Padding" Value="5"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Status}" Value="ØªÙ…">
                                                <Setter Property="Foreground" Value="{StaticResource SuccessColor}"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Ø®Ø·Ø£">
                                                <Setter Property="Foreground" Value="{StaticResource ErrorColor}"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ù…ÙŠØ©...">
                                                <Setter Property="Foreground" Value="{StaticResource PrimaryColor}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>
            </Grid>
        </Grid>
    </ScrollViewer>
</Page>
